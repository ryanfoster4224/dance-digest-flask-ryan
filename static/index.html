<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–ê–Ω–æ–Ω—Å–∏ –≤–µ—á—ñ—Ä–æ–∫ –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.13/dist/vue.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
</head>
<body>
<div id="app">
    <details id="account" v-if="!authorId">
        <summary>–∑–∞–ª–æ–≥—ñ–Ω–∏—Ç–∏—Å—å –≤ —Å–∏—Å—Ç–µ–º—É</summary>
        username: {{ authorId }} <input type="text" placeholder="username" v-model="username">
        password: <input type="password" v-model="password" placeholder="password">
        <button v-on:click="getPermissions">–∑–∞–π—Ç–∏</button>
    </details>

    <section class="section" class="section" style="padding: 1rem 1rem">
        <div class="container">
            <div class="has-text-right">
                <a href="#addEvent" class="has-text-weight-bold">–î–æ–¥–∞—Ç–∏ –∞–Ω–æ–Ω—Å –≤–µ—á—ñ—Ä–∫–∏</a>
            </div>
            <div v-for="e, index in events">
                <div v-if="e.editMode===false">
                    <strong>{{ e.weekday }} - üíÉ{{ e.title }}üï∫</strong> –ø–æ—á–∞—Ç–æ–∫: ‚è∞{{ e.start }}
                    üìç–∞–¥—Ä–µ—Å–∞: {{ e.location }}, –±–∞–ª–∞–Ω—Å –º—É–∑–∏–∫–∏: üé∏{{ e.balance }}, <span
                        v-if="e.price">–≤–∞—Ä—Ç—ñ—Å—Ç—å: üí∞{{ e.price }}</span>

                    <details>
                        <summary>üëâ –¥–∏–≤–∏—Ç–∏—Å—å –ø–æ–≤–Ω—É –≤–µ—Ä—Å—ñ—é –∞–Ω–æ–Ω—Å—É</summary>
                        <pre>{{ e.full }}</pre>
                    </details>

                </div>
                <h2 v-else>
                    <input type="text" v-model="e.title">
                    <input type="text" v-model="e.start">

                    <select v-model="e.weekdayId" required>
                        <option value="-1" selected disabled>–¥–µ–Ω—å —Ç–∏–∂–Ω—è</option>
                        <option v-for="item, index  in weekdays" :value="index">{{ item }}</option>
                    </select>
                    <select v-model="e.location" required>
                        <option value="" selected disabled>–º—ñ—Å—Ü–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—è</option>
                        <option v-for="item  in locations" :value="item">{{ item }}</option>
                    </select>
                    <select v-model="e.balance" required>
                        <option value="–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–æ" selected disabled>–±–∞–ª–∞–Ω—Å –º—É–∑–∏–∫–∏</option>
                        <option v-for="item  in balances" :value="item">{{ item }}</option>
                    </select>
                    <input type="text" v-model="e.price">

                    <br><textarea rows="10" style="width: 80%" v-model="e.full"></textarea>
                    <button v-on:click="saveEvent(index)">–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏</button>
                </h2>
                <div v-if="( authorId===e.authorId || superAdmin)">
                    <button v-on:click="editEvent(index)" class="button is-primary">edit</button>
                    <button v-on:click="remove(e.id)" class="button">delete</button>
                </div>
                <hr>
            </div>

            <div id="addEvent">
                <p>—Ñ–æ—Ä–º–∞ –¥–æ–¥–∞–Ω–Ω—è –∞–Ω–æ–Ω—Å—É –≤–µ—á—ñ—Ä–∫–∏</p>
                <input type="text" minlength="8" v-model="title" placeholder="–Ω–∞–∑–≤–∞ —Ç–∞–Ω—Ü—é–≤–∞–ª—å–Ω–æ—ó –≤–µ—á—ñ—Ä–∫–∏">
                <input v-model="start" type="text" maxlength="5" placeholder="—á–∞—Å –ø–æ—á–∞—Ç–∫—É –≤–µ—á—ñ—Ä–∫–∏">
                <select v-model="weekdayId" required>
                    <option value="-1" selected disabled>–¥–µ–Ω—å —Ç–∏–∂–Ω—è</option>
                    <option v-for="item, index  in weekdays" :value="index">{{ item }}</option>
                </select>
                <select v-model="location" required>
                    <option value="" selected disabled>–≤–∏–±—Ä–∞—Ç–∏ –º—ñ—Å—Ü–µ –∑—ñ —Å–ø–∏—Å–∫—É</option>
                    <option v-for="item  in locations" :value="item">{{ item }}</option>
                </select>
                <input type="text" v-model="customLocation" placeholder="–≤–≤–µ—Å—Ç–∏ –Ω–æ–≤—É –ª–æ–∫–∞—Ü—ñ—é">

                <select v-model="balance" required>
                    <option value="–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–æ" selected disabled>–±–∞–ª–∞–Ω—Å –º—É–∑–∏–∫–∏</option>
                    <option v-for="item  in balances" :value="item">{{ item }}</option>
                </select>

                <br><textarea rows="10" v-model="full" style="width: 80%" placeholder="–¥–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å –ø–æ–¥—ñ—ó"></textarea>

                <div v-if="authorMode">
                    <input type="text" minlength="2" v-model="price"
                           placeholder="–≤–∞—Ä—Ç—ñ—Å—Ç—å: –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∞-–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ —Ü—ñ–Ω–∞">
                </div>
                <div v-if="superAdmin">
                    <input type="text" v-model="brief" placeholder="—Å—Ç–∏—Å–ª–∏–π –æ–ø–∏—Å">
                    author: <select v-model="authorId">
                    <option>cherk</option>
                </select>
                </div>
                <div>
                    <button v-on:click="insertEvent">–¥–æ–¥–∞—Ç–∏ –≤–µ—á—ñ—Ä–∫—É</button>
                </div>
            </div>

        </div>
    </section>


</div>
<a href='http://www.freevisitorcounters.com'>www.Freevisitorcounters.com</a>
<script type='text/javascript'
        src='https://www.freevisitorcounters.com/auth.php?id=e678b7686b427c326ccbaf76bb7766409b1635aa'></script>
<script type="text/javascript" src="https://www.freevisitorcounters.com/en/home/counter/977876/t/1"></script>
<script>
    let app = new Vue({
        el: '#app',
        created: function () {
            this.getEvents()
        },
        data: {
            message: 'hello, events',
            authorId: "",
            username: '',
            password: '',
            currentEventId: -1,
            title: "",
            full: "",
            location: "",
            customLocation: "",
            weekdayId: -1,
            weekday: "–ø–æ–Ω–µ–¥—ñ–ª–æ–∫",
            start: null,
            balance: "–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–æ",
            superAdmin: false,
            authorMode: false,

            brief: null,
            price: null,
            events: [],
            weekdays: ["–ø–æ–Ω–µ–¥—ñ–ª–æ–∫", "–≤—ñ–≤—Ç–æ—Ä–æ–∫", "—Å–µ—Ä–µ–¥–∞", "—á–µ—Ç–≤–µ—Ä", "–ø º—è—Ç–Ω–∏—Ü—è", "—Å—É–±–æ—Ç–∞", "–Ω–µ–¥—ñ–ª—è"],
            balances: [
                "3 bachata, 1 salsa",
                "4 bachata, 1 salsa",
                "1 salsa, 1 bachata",
                "2 salsa, 2 bachata",
                "salsa",
                "3 cubana, 1 bachata",
                "zouk",
                "kizomba",
                "–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–æ"
            ],
            locations: [
                "–∫–∞–º–ø—É—Å, –í—É–ª. –°–∞–∫—Å–∞–≥–∞–Ω—Å—å–∫–æ–≥–æ 1, –º.–ü–∞–ª–∞—Ü —Å–ø–æ—Ä—Ç—É",
                "Signal Event Hall, –ñ–∏–ª—è–Ω—Å—å–∫–∞ 97–±, –º. –í–æ–∫–∑–∞–ª—å–Ω–∞",
                "—Ü–µ–Ω—Ç—Ä –±–∞—á–∞—Ç–∏, –≤—É–ª. –î–∞—Ä–≤–∏–Ω–∞, 1, –º. –¢–µ–∞—Ç—Ä–∞–ª—å–Ω–∞, –∫–æ–¥ #140, 7 –ø–æ–≤–µ—Ä—Ö, ‚Ññ54",
                "Buena Vista,  –≤—É–ª. –í–µ–ª–∏–∫–∞ –ñ–∏—Ç–æ–º–∏—Ä—Å—å–∫–∞ 8/14, –º. –ó–æ–ª–æ—Ç—ñ –≤–æ—Ä–æ—Ç–∞",
                "Just in space, –º. –ü–æ—à—Ç–æ–≤–∞ –ø–ª–æ—â–∞, –≤—É–ª. –ë—Ä–∞—Ç—Å—å–∫–∞ 6",
                "–∞—Ä—Ç-–∫–∞—Ñ–µ –ó–æ–ª–æ—Ç—ñ –í–æ—Ä–æ—Ç–∞, –≤—É–ª. –ú–∏–∫–æ–ª–∏ –õ–∏—Å–µ–Ω–∫–∞, 1, —Å—Ç.–º. –ó–æ–ª–æ—Ç—ñ –≤–æ—Ä–æ—Ç–∞",
                "Nivki Hall –ü—Ä–æ—Å–ø–µ–∫—Ç –ü–µ—Ä–µ–º–æ–≥–∏ 84, –º. –ù–∏–≤–∫–∏",
                "—Ü–µ–Ω—Ç—Ä —Ç–∞–Ω—Ü—ñ–≤,  –≤—É–ª. –î–æ–≤–∂–µ–Ω–∫–∞ 3–∞, –º.–®—É–ª—è–≤—Å–∫–∞",
                "–ª—ñ–≤–æ–±–µ—Ä–µ–∂–Ω–∞ —Å—Ç—É–¥—ñ—è, –≤—É–ª. –î–Ω—ñ–ø—Ä–æ–≤—Å—å–∫–∞ –Ω–∞–±–µ—Ä–µ–∂–Ω–∞ 19, –º. –û—Å–æ–∫–æ—Ä–∫–∏",
                "Ra√≠ces Dance Studio, –≤—É–ª. –ö–∏—Ä–∏–ª—ñ–≤—Å—å–∫–∞,4, –º. –ö–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤–∞ –ø–ª–æ—â–∞",
                "—Å—Ç—É–¥—ñ—è CasaDeRitmo, –º.–û–ª—ñ–º–ø—ñ–π—Å—å–∫–∞, –í—É–ª. –ñ–∏–ª—è–Ω—Å—å–∫–∞, 5–±, –∫–æ–¥ 11–ö",
                "–¥–µ–ø–æ, –≤—É–ª–∏—Ü—è –í–∞—Å–∏–ª—å–∫—ñ–≤—Å—å–∫–∞ 23/6",
                "–ì–æ–Ω—Ü–æ –±–∞—Ä, –≤—É–ª. –ö–æ–ø–µ—Ä–Ω–∏–∫–∞ 2, –º. –ª—É–∫—è–Ω—ñ–≤—Å—å–∫–∞",
                "–∫–æ—Ç–æ–∫–∞—Ñ–µ, –º. –í–æ–∫–∑–∞–ª—å–Ω–∞",
            ]
        },
        methods: {
            getEvents: function () {
                fetch("/api/events").then((response) => {
                    return response.json();
                }).then((data) => {
                    for (let event of data) {
                        event.editMode = false
                        event.id = event._id.$oid
                        if (!this.location.includes(event.location)){
                            this.locations.push(event.location)}
                    }
                    this.events = data
                    console.log(data)
                })
            },

            getPermissions: function () {
                const requestOptions = {
                    method: "GET",
                };
                fetch(`/api/user/?username=${this.username}&password=${this.password}`).then((response) => {
                    return response.json();
                }).then((data) => {
                    console.log(data)
                    this.authorId = data.authorId
                    this.authorMode = data.authorId.length > 0 || data.superAdmin
                    this.superAdmin = data.superAdmin
                })
            },

            insertEvent: function () {
                const body = {
                    title: this.title,
                    full: this.full,

                    start: this.start,

                    price: this.price,
                    balance: this.balance,
                    authorId: this.authorId,
                    published: this.authorId.length > 0
                }
                if (this.weekdayId > -1) {
                    body.weekdayId = this.weekdayId
                    body.weekday = this.weekdays[this.weekdayId]
                }
                if (this.customLocation) {
                    body.location = this.customLocation
                } else if (this.location) {
                    body.location = this.location
                }

                console.log(body)
                const requestOptions = {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify(body)
                }
                fetch("/api/event", requestOptions).then(() => {
                    this.title = ""
                    this.location = ""
                    this.customLocation = ""
                    this.start = ""
                    this.weekdayId = -1
                    this.getEvents()
                })
            },

            editEvent: function (index) {
                this.events[index].editMode = true
            },

            saveEvent: function (index) {
                this.events[index].editMode = false

                const body = {
                    id: this.events[index].id,
                    title: this.events[index].title,
                    full: this.events[index].full,
                    start: this.events[index].start,

                    price: this.events[index].price,
                    balance: this.events[index].balance,
                }
                if (this.events[index].weekdayId > -1) {
                    body.weekdayId = this.events[index].weekdayId
                    body.weekday = this.weekdays[this.events[index].weekdayId]
                }
                if (this.events[index].location) {
                    body.location = this.events[index].location
                }

                console.log(body)
                const requestOptions = {
                    method: "PUT",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify(body)
                }
                fetch("/api/event", requestOptions).then(() => {
                    this.getEvents()
                })
            },

            remove: function (id) {
                console.log('deleting ' + id)
                if (!confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –≤–µ—á—ñ—Ä–∫—É?')) {
                    return
                }

                const requestOptions = {
                    method: "DELETE",
                    headers: {"Content-Type": "application/json"},
                };
                fetch("/api/event/" + id, requestOptions).then(() => {
                    this.getEvents()
                })
            }
            ,
        }
    })
</script>
</body>
</html>